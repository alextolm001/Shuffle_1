# ðŸ”¹ Basis: officiÃ«le Python 3.8 image met Debian Bullseye
FROM python:3.8-bullseye

# ðŸ”¹ Metadata (voor traceerbaarheid)
LABEL maintainer="alextolm001@gmail.com" \
      version="1.0" \
      description="Shuffle_1 container voor Eurovision stemverwerking"

# ðŸ”¹ Systeemafhankelijkheden: Java en Git voor PySpark + repo-kloon
RUN apt-get update && apt-get install -y --no-install-recommends \
    openjdk-11-jdk \
    git \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# ðŸ”¹ Zet Java-omgeving
ENV JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
ENV PATH="${JAVA_HOME}/bin:${PATH}"

# ðŸ”¹ Werkdirectory voor scripts
WORKDIR /app

# ðŸ”¹ Installeer vereiste Python-pakketten in Ã©Ã©n pip-oproep
RUN pip install --no-cache-dir \
    pyspark \
    google-api-python-client \
    google-auth \
    google-auth-httplib2 \
    google-auth-oauthlib

# ðŸ”¹ Clone de GitHub-repo (jouw repo met scripts)
RUN git clone https://github.com/alextolm001/Shuffle_1.git /app/code

# ðŸ”¹ Kopieer specifiek script dat uitgevoerd moet worden
RUN cp /app/code/count_votes.py .

# ðŸ”¹ (Optioneel) service_account.json mount je extern via volume

# ðŸ”¹ Start het script bij containeropstart
CMD ["python", "count_votes.py"]
